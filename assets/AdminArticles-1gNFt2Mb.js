import{p as x}from"./paginationComponent-NVJis1nn.js";import{_ as b,r as f,o as l,c,d as t,e as _,w as k,F as A,k as w,f as m,t as u}from"./index-1INmv1Cf.js";var C={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"wandererland",BASE_URL:"/WandererLand/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:h,VITE_PATH:d}=C,T={data(){return{currentArticles:[],pagination:{},isNew:!1,swalQuestionWithBootstrapButtons:null,swalInfoCheckWithBootstrapButtons:null}},methods:{getCurrentArticles(e=1){const o=`${h}/api/${d}/admin/articles?page=${e}`;this.axios.get(o).then(s=>{const{articles:a,pagination:n}=s.data;this.currentArticles=a,this.pagination=n,console.log("this.currentArticles",this.currentArticles)}).catch(s=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:s.response.data.message,confirmButtonText:"確認"})})},showArticlePage(e){this.$router.push(`/admin/articleinfo/${e}`)},deleteArticle(e){const o=`${h}/api/${d}/admin/article/${e}`;this.swalQuestionWithBootstrapButtons.fire({title:"確定要刪除文章嗎？",text:"這個動作無法復原",icon:"question",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"確認刪除"}).then(s=>{if(s.isConfirmed){const a=this.$loading.show();this.axios.delete(o).then(n=>{this.swalInfoCheckWithBootstrapButtons.fire({title:n.data.message,confirmButtonText:"確認"}),this.getCurrentArticles()}).catch(n=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:n.response.data.message,confirmButtonText:"確認"})}).finally(()=>{a.hide()})}})},checkTopArticle(e){return this.currentArticles.filter(s=>s.isTop===!0)},async setTopArticle(e){const o=await this.checkTopArticle(e);if(!o.length){const s=this.$loading.show(),a=await this.getArticleInfo(e);a.isTop=!0;const n=`${h}/api/${d}/admin/article/${e}`;return this.axios.put(n,{data:a}).then(r=>{this.swalInfoCheckWithBootstrapButtons.fire({title:"已設為置頂",confirmButtonText:"確認"}),this.getCurrentArticles()}).catch(r=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:r.response.data.message,confirmButtonText:"確認"})}).finally(()=>{s.hide()}),!1}if(o[0].id===e){const s=this.$loading.show(),a=await this.getArticleInfo(e);a.isTop=!1;const n=`${h}/api/${d}/admin/article/${e}`;return this.axios.put(n,{data:a}).then(r=>{this.swalInfoCheckWithBootstrapButtons.fire({title:"已取消置頂",confirmButtonText:"確認"}),this.getCurrentArticles()}).catch(r=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:r.response.data.message,confirmButtonText:"確認"})}).finally(()=>{s.hide()}),!1}if(o[0].id!==e){const s=`topArticleCheckBox${e}`;return this.$refs[s][0].checked=!1,this.swalInfoCheckWithBootstrapButtons.fire({title:"請先取消當前置頂文章",confirmButtonText:"確認"}),!1}},getArticleInfo(e){const o=`${h}/api/${d}/admin/article/${e}`;return this.axios.get(o).then(s=>s.data.article).catch(s=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:s.response.data.message,confirmButtonText:"確認"})})}},components:{paginationComponent:x},mounted(){this.getCurrentArticles(),this.swalQuestionWithBootstrapButtons=this.$swal.mixin({customClass:{confirmButton:"m-1 btn btn-outline-default",cancelButton:"m-1 btn btn-default"},buttonsStyling:!1}),this.swalInfoCheckWithBootstrapButtons=this.$swal.mixin({customClass:{confirmButton:"m-1 btn btn-default"},buttonsStyling:!1})}},y={class:"overflow-y-scroll scrollbar-y-hide vh-100"},$={class:"d-flex justify-content-between py-4 py-md-7"},I=t("h2",{class:"fw-bold"},"文章管理",-1),v={key:0,class:"py-5 text-center"},W={key:1,class:"table align-middle fs-info fs-md-6"},E=t("thead",null,[t("tr",null,[t("th",{class:"text-nowrap"},[m("首頁"),t("span",{class:"d-block d-md-inline"},"置頂")]),t("th",null,"標題"),t("th",{class:"d-none d-md-table-cell"},"分類"),t("th",null,"狀態"),t("th",{class:"d-none d-lg-table-cell"},"作者"),t("th",{class:"d-none d-md-table-cell"},"撰寫日期"),t("th")])],-1),P=["onClick","checked"],V={class:"d-none d-md-table-cell"},L={class:"py-1 rounded-pill bg-light text-center text-nowrap"},S={key:0,class:"text-danger text-nowrap"},D={key:1},N={class:"d-none d-lg-table-cell"},Q={class:"d-none d-md-table-cell"},R={class:"btn-group align-items-center"},F=["onClick"],G=t("i",{class:"bi bi-pencil text-default"},null,-1),H=[G],O=["onClick"],j=t("i",{class:"bi bi-trash text-danger"},null,-1),q=[j];function M(e,o,s,a,n,r){const g=f("router-link"),B=f("paginationComponent");return l(),c("div",y,[t("div",$,[I,_(g,{to:"/admin/articleinfo/new",class:"btn btn-dark"},{default:k(()=>[m("建立文章")]),_:1})]),t("div",null,[n.currentArticles.length?(l(),c("table",W,[E,t("tbody",null,[(l(!0),c(A,null,w(n.currentArticles,i=>(l(),c("tr",{key:i.id},[t("td",null,[t("input",{class:"form-check-input",type:"checkbox",id:"checkboxNoLabel",value:"","aria-label":"setTopArticle",onClick:p=>r.setTopArticle(i.id),checked:i.isTop,ref_for:!0,ref:"topArticleCheckBox"+i.id},null,8,P)]),t("td",null,u(i.title),1),t("td",V,[t("p",L,u(i.category),1)]),t("td",null,[i.isPublic?(l(),c("span",S,"發佈中")):(l(),c("span",D,"未發佈"))]),t("td",N,u(i.author),1),t("td",Q,u(new Date(i.create_at*1e3).toLocaleDateString()),1),t("td",null,[t("div",R,[t("button",{type:"button",class:"btn border-0",onClick:p=>r.showArticlePage(i.id)},H,8,F),t("button",{type:"button",class:"btn border-0",onClick:p=>r.deleteArticle(i.id)},q,8,O)])])]))),128))])])):(l(),c("p",v,"目前沒有文章")),_(B,{pagination:n.pagination,onGetList:r.getCurrentArticles},null,8,["pagination","onGetList"])])])}const J=b(T,[["render",M]]);export{J as default};
