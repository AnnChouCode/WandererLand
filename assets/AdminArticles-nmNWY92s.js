import{p as k}from"./paginationComponent-v7OYHwga.js";import{_ as w,r as m,o as r,c,b as t,d as p,w as b,F as A,i as C,e as B,t as u,n as g}from"./index-9M2FzS39.js";var T={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"wandererland",BASE_URL:"/WandererLand/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:h,VITE_PATH:d}=T,$={data(){return{currentArticles:[],pagination:{},isNew:!1,swalQuestionWithBootstrapButtons:null,swalInfoCheckWithBootstrapButtons:null}},methods:{getCurrentArticles(e=1){const i=`${h}/api/${d}/admin/articles?page=${e}`;this.axios.get(i).then(s=>{const{articles:a,pagination:o}=s.data;this.currentArticles=a,this.pagination=o}).catch(s=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:s.response.data.message,confirmButtonText:"確認"})})},showArticlePage(e){this.$router.push(`/admin/articleinfo/${e}`)},deleteArticle(e){const i=`${h}/api/${d}/admin/article/${e}`;this.swalQuestionWithBootstrapButtons.fire({title:"確定要刪除文章嗎？",text:"這個動作無法復原",icon:"question",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"確認刪除"}).then(s=>{if(s.isConfirmed){const a=this.$loading.show();this.axios.delete(i).then(o=>{this.swalInfoCheckWithBootstrapButtons.fire({title:o.data.message,confirmButtonText:"確認"}),this.getCurrentArticles()}).catch(o=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:o.response.data.message,confirmButtonText:"確認"})}).finally(()=>{a.hide()})}})},checkTopArticle(e){return this.currentArticles.filter(s=>s.isTop===!0)},async setTopArticle(e){const i=await this.checkTopArticle(e);if(!i.length){const s=this.$loading.show(),a=await this.getArticleInfo(e);a.isTop=!0;const o=`${h}/api/${d}/admin/article/${e}`;return this.axios.put(o,{data:a}).then(l=>{this.swalInfoCheckWithBootstrapButtons.fire({title:"已設為置頂",confirmButtonText:"確認"}),this.getCurrentArticles()}).catch(l=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:l.response.data.message,confirmButtonText:"確認"})}).finally(()=>{s.hide()}),!1}if(i[0].id===e){const s=this.$loading.show(),a=await this.getArticleInfo(e);a.isTop=!1;const o=`${h}/api/${d}/admin/article/${e}`;return this.axios.put(o,{data:a}).then(l=>{this.swalInfoCheckWithBootstrapButtons.fire({title:"已取消置頂",confirmButtonText:"確認"}),this.getCurrentArticles()}).catch(l=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:l.response.data.message,confirmButtonText:"確認"})}).finally(()=>{s.hide()}),!1}if(i[0].id!==e){const s=`topArticleCheckBox${e}`;return this.$refs[s][0].checked=!1,this.swalInfoCheckWithBootstrapButtons.fire({title:"請先取消當前置頂文章",confirmButtonText:"確認"}),!1}},getArticleInfo(e){const i=`${h}/api/${d}/admin/article/${e}`;return this.axios.get(i).then(s=>s.data.article).catch(s=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:s.response.data.message,confirmButtonText:"確認"})})}},components:{paginationComponent:k},mounted(){this.getCurrentArticles(),this.swalQuestionWithBootstrapButtons=this.$swal.mixin({customClass:{confirmButton:"m-1 btn btn-outline-default",cancelButton:"m-1 btn btn-default"},buttonsStyling:!1}),this.swalInfoCheckWithBootstrapButtons=this.$swal.mixin({customClass:{confirmButton:"m-1 btn btn-default"},buttonsStyling:!1})}},y={class:"overflow-y-scroll scrollbar-y-hide vh-100"},I={class:"d-flex justify-content-between py-4 py-md-7"},v=t("h2",{class:"fw-bold"},"文章管理",-1),W={key:0,class:"py-5 text-center"},P={key:1,class:"table align-middle fs-info fs-md-6"},E=t("thead",null,[t("tr",null,[t("th",{class:"text-nowrap"},[B("首頁"),t("span",{class:"d-block d-md-inline"},"置頂")]),t("th",null,"標題"),t("th",{class:"d-none d-md-table-cell"},"分類"),t("th",null,"狀態"),t("th",{class:"d-none d-lg-table-cell"},"作者"),t("th",{class:"d-none d-md-table-cell"},"撰寫日期"),t("th")])],-1),V=["onClick","checked"],L={class:"d-none d-md-table-cell"},S={class:"py-1 rounded-pill bg-light text-center text-nowrap"},D={key:0,class:"text-danger text-nowrap"},N={key:1},Q={class:"d-none d-lg-table-cell"},R={class:"d-none d-md-table-cell"},F={class:"btn-group align-items-center"},G=["onClick"],H=t("i",{class:"bi bi-pencil text-default"},null,-1),O=[H],j=["onClick"],q=t("i",{class:"bi bi-trash text-danger"},null,-1),z=[q];function M(e,i,s,a,o,l){const f=m("router-link"),x=m("paginationComponent");return r(),c("div",y,[t("div",I,[v,p(f,{to:"/admin/articleinfo/new",class:"btn btn-dark"},{default:b(()=>[B("建立文章")]),_:1})]),t("div",null,[o.currentArticles.length?(r(),c("table",P,[E,t("tbody",null,[(r(!0),c(A,null,C(o.currentArticles,n=>(r(),c("tr",{key:n.id},[t("td",null,[t("input",{class:"form-check-input",type:"checkbox",id:"checkboxNoLabel",value:"","aria-label":"setTopArticle",onClick:_=>l.setTopArticle(n.id),checked:n.isTop,ref_for:!0,ref:"topArticleCheckBox"+n.id},null,8,V)]),t("td",null,u(n.title),1),t("td",L,[t("p",S,u(n.category),1)]),t("td",null,[n.isPublic?(r(),c("span",D,"發佈中")):(r(),c("span",N,"未發佈"))]),t("td",Q,u(n.author),1),t("td",R,u(new Date(n.create_at*1e3).toLocaleDateString()),1),t("td",null,[t("div",F,[t("button",{type:"button",class:"btn border-0",onClick:_=>l.showArticlePage(n.id)},O,8,G),t("button",{type:"button",class:"btn border-0",onClick:_=>l.deleteArticle(n.id)},z,8,j),p(f,{class:g(["d-none d-sm-table-cell btn border-0",{"pe-none":!n.isPublic}]),target:"_blank",to:`/articleinfo/${n.id}`},{default:b(()=>[t("i",{class:g(["bi bi-house",n.isPublic?"text-default":"text-light"])},null,2)]),_:2},1032,["to","class"])])])]))),128))])])):(r(),c("p",W,"目前沒有文章")),p(x,{pagination:o.pagination,onGetList:l.getCurrentArticles},null,8,["pagination","onGetList"])])])}const K=w($,[["render",M]]);export{K as default};
