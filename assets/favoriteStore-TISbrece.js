import{s as a,u as c}from"./index-p3dfmI7C.js";import{s as n}from"./statusStore-lod3dZtI.js";import{c as d}from"./userCartStore-5H9ak0FE.js";var l={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"wandererland",BASE_URL:"/WandererLand/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:f,VITE_PATH:u}=l,p=a("favoriteStore",{state:()=>({favoriteList:[],recentlyProducts:[],favoriteProducts:[]}),actions:{handleFavorite(t){const e=this.favoriteList.indexOf(t);e===-1?this.favoriteList.push(t):this.favoriteList.splice(e,1),this.setStorage();const{addMsg:r}=n();r("bi-info-circle","收藏已更新")},setStorage(){localStorage.setItem("favoriteList",this.favoriteList)},getFavoriteList(){const t=localStorage.getItem("favoriteList");t&&(this.favoriteList=t.split(","))},recentlyViewed(t){const e=this.recentlyProducts.findIndex(r=>r.id===t.id);e===-1?(this.recentlyProducts.unshift(t),this.recentlyProducts.length>=8&&this.recentlyProducts.pop()):(this.recentlyProducts.splice(e,1),this.recentlyProducts.unshift(t)),localStorage.setItem("recentlyList",JSON.stringify(this.recentlyProducts))},async getFavoriteProducts(){try{const{cartsList:t}=d(),r=(await Promise.all(this.favoriteList.map(async s=>{const i=`${f}/api/${u}/product/${s}`;return(await c.get(i)).data.product}))).map(s=>{const i=t.carts.find(o=>o.product_id===s.id);return{...s,availableQty:i?s.quantity-i.qty:s.quantity}});this.favoriteProducts=r}catch(t){console.log("Error getFavoriteProducts:",t)}}}});export{p as f};
