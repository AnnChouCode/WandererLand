import{y as c,s as n,u as d}from"./index-xmiksIz9.js";import{s as l}from"./statusStore-6zkUPUqb.js";import{c as f}from"./userCartStore-_tDpqxyj.js";var u={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"wandererland",BASE_URL:"/WandererLand/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const h=c.useLoading(),{VITE_API:v,VITE_PATH:p}=u,g=n("favoriteStore",{state:()=>({favoriteList:[],recentlyProducts:[],favoriteProducts:[]}),actions:{handleFavorite(t){const e=this.favoriteList.indexOf(t);e===-1?this.favoriteList.push(t):this.favoriteList.splice(e,1),this.setStorage();const{addMsg:r}=l();r("bi-info-circle","收藏已更新")},setStorage(){localStorage.setItem("favoriteList",this.favoriteList)},getFavoriteList(){const t=localStorage.getItem("favoriteList");t&&(this.favoriteList=t.split(","))},recentlyViewed(t){const e=this.recentlyProducts.findIndex(r=>r.id===t.id);e===-1?(this.recentlyProducts.unshift(t),this.recentlyProducts.length>=8&&this.recentlyProducts.pop()):(this.recentlyProducts.splice(e,1),this.recentlyProducts.unshift(t)),localStorage.setItem("recentlyList",JSON.stringify(this.recentlyProducts))},async getFavoriteProducts(){try{const t=h.show(),{cartsList:e}=f(),a=(await Promise.all(this.favoriteList.map(async s=>{const i=`${v}/api/${p}/product/${s}`;return(await d.get(i)).data.product}))).map(s=>{const i=e.carts.find(o=>o.product_id===s.id);return{...s,availableQty:i?s.quantity-i.qty:s.quantity}});this.favoriteProducts=a,t.hide()}catch(t){console.log("Error getFavoriteProducts:",t)}}}});export{g as f};
