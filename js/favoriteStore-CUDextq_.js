import{d as c}from"./pinia-D1tb24LR.js";import{s as n}from"./statusStore-bNOcWQBU.js";import{c as d}from"./userCartStore-ldkYgq0X.js";import{a as l}from"./axios-Di5RpEPX.js";import{d as f}from"./vue-loading-overlay-CtFUBeEI.js";var u={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"wandererland",BASE_URL:"/WandererLand/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const h=f.useLoading(),{VITE_API:v,VITE_PATH:p}=u,S=c("favoriteStore",{state:()=>({favoriteList:[],recentlyProducts:[],favoriteProducts:[]}),actions:{handleFavorite(t){const e=this.favoriteList.indexOf(t);e===-1?this.favoriteList.push(t):this.favoriteList.splice(e,1),this.setStorage();const{addMsg:r}=n();r("bi-info-circle","收藏已更新")},setStorage(){localStorage.setItem("favoriteList",this.favoriteList)},getFavoriteList(){const t=localStorage.getItem("favoriteList");t&&(this.favoriteList=t.split(","))},recentlyViewed(t){const e=this.recentlyProducts.findIndex(r=>r.id===t.id);e===-1?(this.recentlyProducts.unshift(t),this.recentlyProducts.length>=8&&this.recentlyProducts.pop()):(this.recentlyProducts.splice(e,1),this.recentlyProducts.unshift(t)),localStorage.setItem("recentlyList",JSON.stringify(this.recentlyProducts))},async getFavoriteProducts(){try{const t=h.show(),{cartsList:e}=d(),a=(await Promise.all(this.favoriteList.map(async s=>{const o=`${v}/api/${p}/product/${s}`;return(await l.get(o)).data.product}))).map(s=>{const o=e.carts.find(i=>i.product_id===s.id);return{...s,availableQty:o?s.quantity-o.qty:s.quantity}});this.favoriteProducts=a,t.hide()}catch(t){console.log("Error getFavoriteProducts:",t)}}}});export{S as f};
