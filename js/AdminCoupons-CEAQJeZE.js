import{P as k}from"./PaginationComponent-BwQC0gLo.js";import{M as x}from"./bootstrap-B1ByGxZb.js";import{a_ as _,aR as a,a5 as d,a6 as t,ba as f,ae as u,bx as B,aG as b,bz as y,bm as I,L as g,aY as M}from"./@vue-Cqo5QHyB.js";import{_ as v}from"./index-Bv_xgM6y.js";import"./@popperjs-WhmJkuoZ.js";import"./@ckeditor-RgNY5E4z.js";import"./vue-ZlQZhsMo.js";import"./pinia-D1tb24LR.js";import"./axios-Di5RpEPX.js";import"./vue-axios-BaogFJPH.js";import"./vue-loading-overlay-CtFUBeEI.js";import"./vue-sweetalert2-BkTfjfvc.js";import"./sweetalert2-Bxbxx77j.js";import"./vee-validate-CasJ09EL.js";import"./@vee-validate-DziBkgPq.js";/* empty css                        */import"./aos-C_17NL_K.js";import"./vue-router-DOL1scXn.js";const V={data(){return{modal:null,tempCouponInfo:{},due_date:""}},props:["couponInfo","isNew"],watch:{couponInfo(){this.tempCouponInfo=this.couponInfo;const s=new Date(this.couponInfo.due_date*1e3).toISOString().split("T");this.due_date=s[0]},due_date(){const s=new Date(this.due_date);this.tempCouponInfo.due_date=Math.floor(s/1e3)}},methods:{openModal(){this.modal.show()},closeModal(){this.$refs.modalForm.resetForm(),this.modal.hide()}},mounted(){this.modal=new x(this.$refs.adminCouponModal,{keyboard:!1,backdrop:"static"})}},$={class:"modal",tabindex:"-1",ref:"adminCouponModal"},L={class:"modal-dialog modal-lg modal-dialog-centered"},T={class:"modal-content"},N={class:"modal-header"},W={key:0,class:"modal-title fw-bold"},q={key:1,class:"modal-title fw-bold"},A={class:"modal-body"},P=t("label",{for:"title",class:"form-label fw-bold has-required"},"優惠券標題",-1),S=t("label",{for:"code",class:"form-label fw-bold has-required"},"優惠碼",-1),D=t("span",{class:"ms-2 text-info fs-info"},"建立後無法更改",-1),E=t("label",{for:"discound",class:"form-label fw-bold has-required"},"訂單折扣百分比",-1),U=t("span",{class:"ms-2 text-info fs-info"},"建立後無法更改",-1),F=t("label",{for:"due_date",class:"form-label fw-bold has-required"},"優惠到期日",-1),R={class:"form-check form-switch"},G={class:"form-check-label",for:"is_enabled"},O={key:0},Q={key:1},j={class:"d-flex justify-content-end gap-2 pt-3"};function z(s,o,n,r,e,l){const m=_("v-field"),h=_("error-message"),c=_("v-form");return a(),d("div",$,[t("div",L,[t("div",T,[t("div",N,[n.isNew?(a(),d("h5",W,"建立優惠券")):(a(),d("h5",q,"優惠券："+f(e.tempCouponInfo.code),1)),t("button",{type:"button",class:"btn-close",onClick:o[0]||(o[0]=(...p)=>l.closeModal&&l.closeModal(...p))})]),t("div",A,[u(c,{class:"d-flex flex-column gap-5",ref:"modalForm"},{default:B(({errors:p})=>[t("div",null,[P,u(m,{class:b(["form-control",{"is-invalid":p.title}]),type:"text",placeholder:"請輸入標題",modelValue:e.tempCouponInfo.title,"onUpdate:modelValue":o[1]||(o[1]=i=>e.tempCouponInfo.title=i),id:"title",name:"title",rules:"required"},null,8,["modelValue","class"]),u(h,{name:"title",class:"invalid-feedback"})]),t("div",null,[S,D,u(m,{class:b(["form-control",{"is-invalid":p.code}]),placeholder:"請輸入 6-24 個字元內的英數組合優惠碼",modelValue:e.tempCouponInfo.code,"onUpdate:modelValue":o[2]||(o[2]=i=>e.tempCouponInfo.code=i),id:"code",name:"code",rules:"required|alpha_num|max:24|min:6",disabled:!n.isNew},null,8,["modelValue","class","disabled"]),u(h,{name:"code",class:"invalid-feedback"})]),t("div",null,[E,U,u(m,{class:b(["form-control",{"is-invalid":p.code}]),type:"number",placeholder:"請輸入 1-99",modelValue:e.tempCouponInfo.percent,"onUpdate:modelValue":o[3]||(o[3]=i=>e.tempCouponInfo.percent=i),modelModifiers:{number:!0},id:"discount",name:"discount",rules:"required|between:1,99",disabled:!n.isNew},null,8,["modelValue","class","disabled"]),u(h,{name:"discount",class:"invalid-feedback"})]),t("div",null,[F,u(m,{class:b(["form-control",{"is-invalid":p.due_date}]),type:"date",placeholder:"請設定日期",modelValue:e.due_date,"onUpdate:modelValue":o[4]||(o[4]=i=>e.due_date=i),id:"due_date",name:"due_date",rules:"required"},null,8,["modelValue","class"]),u(h,{name:"due_date",class:"invalid-feedback"})]),t("div",R,[y(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"is_enabled","onUpdate:modelValue":o[5]||(o[5]=i=>e.tempCouponInfo.is_enabled=i),checked:"","true-value":1,"false-value":0},null,512),[[I,e.tempCouponInfo.is_enabled]]),t("label",G,[e.tempCouponInfo.is_enabled?(a(),d("span",O,"更改為未啟用")):(a(),d("span",Q,"更改為已啟用"))])]),t("div",j,[t("button",{type:"button",class:"btn btn-outline-dark",onClick:o[6]||(o[6]=(...i)=>l.closeModal&&l.closeModal(...i))},"取消"),t("button",{type:"button",class:"btn btn-dark text-white",onClick:o[7]||(o[7]=i=>this.$emit("updateCoupon",e.tempCouponInfo))},f(n.isNew?"新增優惠券":"更新優惠券"),1)])]),_:1},512)])])])],512)}const H=v(V,[["render",z]]);var Y={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"wandererland",BASE_URL:"/WandererLand/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:C,VITE_PATH:w}=Y,J={data(){return{couponList:[],pagination:{},tempCoupon:{},isNew:!1,swalQuestionWithBootstrapButtons:null,swalInfoCheckWithBootstrapButtons:null}},methods:{getCouponList(s=1){const o=`${C}/api/${w}/admin/coupons?page=${s}`;this.axios.get(o).then(n=>{const{coupons:r,pagination:e}=n.data;this.couponList=r,this.pagination=e}).catch(n=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:n.response.data.message,confirmButtonText:"確認"})})},updateCoupon(s){const o=this.$loading.show();let n=`${C}/api/${w}/admin/coupon`,r="post";this.isNew||(n+=`/${s.id}`,r="put"),this.axios[r](n,{data:s}).then(e=>{this.swalInfoCheckWithBootstrapButtons.fire({title:e.data.message,confirmButtonText:"確認"}),this.$refs.adminCouponModal.closeModal(),this.getCouponList()}).catch(e=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:e.response.data.message,confirmButtonText:"確認"})}).finally(()=>{o.hide()})},showCoupon(s,o){s==="create"&&(this.isNew=!0),s==="edit"&&(this.isNew=!1,this.tempCoupon={...o}),this.$refs.adminCouponModal.openModal()},deleteCoupon(s){const o=`${C}/api/${w}/admin/coupon/${s}`,n=`確定要刪除優惠券 <span class="text-danger">${s}</span> 嗎？`;this.swalQuestionWithBootstrapButtons.fire({title:n,text:"請再次確認，以免影響顧客權益",icon:"question",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"確認刪除"}).then(r=>{if(r.isConfirmed){const e=this.$loading.show();this.axios.delete(o).then(l=>{this.swalInfoCheckWithBootstrapButtons.fire({title:l.data.message,confirmButtonText:"確認"}),this.getCouponList()}).catch(l=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:l.response.data.message,confirmButtonText:"確認"})}).finally(()=>{e.hide()})}})}},components:{PaginationComponent:k,AdminCouponModal:H},mounted(){this.getCouponList(),this.swalQuestionWithBootstrapButtons=this.$swal.mixin({customClass:{confirmButton:"m-1 btn btn-outline-default",cancelButton:"m-1 btn btn-default"},buttonsStyling:!1}),this.swalInfoCheckWithBootstrapButtons=this.$swal.mixin({customClass:{confirmButton:"m-1 btn btn-default"},buttonsStyling:!1})}},K={class:"overflow-y-scroll scrollbar-y-hide vh-100"},X={class:"d-flex justify-content-between py-4 py-md-7"},Z=t("h2",{class:"fw-bold"},"優惠券管理",-1),tt={key:0,class:"py-5 text-center"},ot={key:1,class:"table align-middle fs-info fs-md-6"},et=t("thead",null,[t("tr",null,[t("th",{class:"d-none d-md-table-cell"},"優惠碼"),t("th",null,"型式"),t("th",null,"到期日"),t("th",null,"狀態"),t("th")])],-1),st={class:"d-none d-md-table-cell"},nt={class:"fw-bold"},lt={class:"text-default"},it={key:0,class:"text-danger"},at={key:1},dt={class:"btn-group align-items-center"},ct=["onClick"],ut=t("i",{class:"bi bi-pencil text-default"},null,-1),rt=[ut],pt=["onClick"],mt=t("i",{class:"bi bi-trash text-danger"},null,-1),ht=[mt];function ft(s,o,n,r,e,l){const m=_("PaginationComponent"),h=_("AdminCouponModal");return a(),d(g,null,[t("div",K,[t("div",X,[Z,t("button",{type:"button",class:"btn btn-dark",onClick:o[0]||(o[0]=c=>l.showCoupon("create"))},"建立優惠券")]),t("div",null,[e.couponList.length?(a(),d("table",ot,[et,t("tbody",null,[(a(!0),d(g,null,M(e.couponList,c=>(a(),d("tr",{key:c.id},[t("td",st,f(c.code),1),t("td",null,[t("p",nt,f(c.title),1),t("span",lt,"折扣："+f(c.percent)+" %",1)]),t("td",null,f(new Date(c.due_date*1e3).toLocaleDateString()),1),t("td",null,[c.is_enabled?(a(),d("span",it,"啟用中")):(a(),d("span",at,"未啟用"))]),t("td",null,[t("div",dt,[t("button",{type:"button",class:"btn border-0",onClick:p=>l.showCoupon("edit",c)},rt,8,ct),t("button",{type:"button",class:"btn border-0",onClick:p=>l.deleteCoupon(c.id)},ht,8,pt)])])]))),128))])])):(a(),d("p",tt,"目前沒有優惠券")),u(m,{pagination:e.pagination,onGetList:l.getCouponList},null,8,["pagination","onGetList"])])]),u(h,{isNew:e.isNew,couponInfo:e.tempCoupon,ref:"adminCouponModal",onUpdateCoupon:l.updateCoupon},null,8,["isNew","couponInfo","onUpdateCoupon"])],64)}const qt=v(J,[["render",ft]]);export{qt as default};
