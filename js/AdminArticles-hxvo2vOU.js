import{P as A}from"./PaginationComponent-zQ1blTHd.js";import{_ as k}from"./index-X9TikCm4.js";import{a_ as _,aR as r,a5 as c,a6 as t,ae as p,bx as g,L as w,aY as C,ad as B,ba as u,aG as b}from"./@vue-RtdEgFn9.js";import"./pinia-MbC3oHy8.js";import"./axios-xY6ymfx7.js";import"./vue-axios-1bbP-7uc.js";import"./vue-loading-overlay-6MyPOO4d.js";import"./@ckeditor-15bwuaMj.js";import"./vue-ogx55dXw.js";import"./vue-sweetalert2-HUKuUMJw.js";import"./sweetalert2-ZSPr1-be.js";import"./vee-validate-O19HqbHO.js";import"./@vee-validate-Akla6Y1w.js";import"./bootstrap-HkqsEQF2.js";import"./@popperjs-kvWuk1nc.js";/* empty css                        */import"./aos-n3b4jLc5.js";import"./vue-router-RDvB-lrw.js";var T={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"wandererland",BASE_URL:"/WandererLand/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:h,VITE_PATH:d}=T,$={data(){return{currentArticles:[],allArticles:[],pagination:{},isNew:!1,swalQuestionWithBootstrapButtons:null,swalInfoCheckWithBootstrapButtons:null}},methods:{getCurrentArticles(e=1){const o=`${h}/api/${d}/admin/articles?page=${e}`;this.axios.get(o).then(s=>{const{articles:i,pagination:n}=s.data;this.currentArticles=i,this.pagination=n,this.getAllArticles(this.pagination.total_pages)}).catch(s=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:s.response.data.message,confirmButtonText:"確認"})})},getAllArticles(e){this.allArticles=[];for(let o=1;o<=e;o++){const s=`${h}/api/${d}/admin/articles?page=${o}`;this.axios.get(s).then(i=>{const{articles:n}=i.data;this.allArticles=this.allArticles.concat(n)}).catch(i=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:i.response.data.message,confirmButtonText:"確認"})})}},showArticlePage(e){this.$router.push(`/admin/articleinfo/${e}`)},deleteArticle(e){const o=`${h}/api/${d}/admin/article/${e}`;this.swalQuestionWithBootstrapButtons.fire({title:"確定要刪除文章嗎？",text:"這個動作無法復原",icon:"question",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"確認刪除"}).then(s=>{if(s.isConfirmed){const i=this.$loading.show();this.axios.delete(o).then(n=>{this.swalInfoCheckWithBootstrapButtons.fire({title:n.data.message,confirmButtonText:"確認"}),this.getCurrentArticles()}).catch(n=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:n.response.data.message,confirmButtonText:"確認"})}).finally(()=>{i.hide()})}})},checkTopArticle(e){return this.allArticles.filter(s=>s.isTop===!0)},async setTopArticle(e){try{const o=await this.checkTopArticle(e);if(!o.length){const s=this.$loading.show(),i=await this.getArticleInfo(e);i.isTop=!0;const n=`${h}/api/${d}/admin/article/${e}`;return this.axios.put(n,{data:i}).then(l=>{this.swalInfoCheckWithBootstrapButtons.fire({title:"已設為置頂",confirmButtonText:"確認"}),this.getCurrentArticles()}).catch(l=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:l.response.data.message,confirmButtonText:"確認"})}).finally(()=>{s.hide()}),!1}if(o[0].id===e){const s=this.$loading.show(),i=await this.getArticleInfo(e);i.isTop=!1;const n=`${h}/api/${d}/admin/article/${e}`;return this.axios.put(n,{data:i}).then(l=>{this.swalInfoCheckWithBootstrapButtons.fire({title:"已取消置頂",confirmButtonText:"確認"}),this.getCurrentArticles()}).catch(l=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:l.response.data.message,confirmButtonText:"確認"})}).finally(()=>{s.hide()}),!1}if(o[0].id!==e){const s=`topArticleCheckBox${e}`;return this.$refs[s][0].checked=!1,this.swalInfoCheckWithBootstrapButtons.fire({title:"請先取消當前置頂文章",confirmButtonText:"確認"}),!1}}catch(o){throw console.log("錯誤:",o),o}},getArticleInfo(e){const o=`${h}/api/${d}/admin/article/${e}`;return this.axios.get(o).then(s=>s.data.article).catch(s=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:s.response.data.message,confirmButtonText:"確認"})})}},components:{PaginationComponent:A},mounted(){this.getCurrentArticles(),this.swalQuestionWithBootstrapButtons=this.$swal.mixin({customClass:{confirmButton:"m-1 btn btn-outline-default",cancelButton:"m-1 btn btn-default"},buttonsStyling:!1}),this.swalInfoCheckWithBootstrapButtons=this.$swal.mixin({customClass:{confirmButton:"m-1 btn btn-default"},buttonsStyling:!1})}},y={class:"overflow-y-scroll scrollbar-y-hide vh-100"},I={class:"d-flex justify-content-between py-4 py-md-7"},W=t("h2",{class:"fw-bold"},"文章管理",-1),v={key:0,class:"py-5 text-center"},P={key:1,class:"table align-middle fs-info fs-md-6"},E=t("thead",null,[t("tr",null,[t("th",{class:"text-nowrap"},[B("首頁"),t("span",{class:"d-block d-md-inline"},"置頂")]),t("th",null,"標題"),t("th",{class:"d-none d-md-table-cell"},"分類"),t("th",null,"狀態"),t("th",{class:"d-none d-lg-table-cell"},"作者"),t("th",{class:"d-none d-md-table-cell"},"撰寫日期"),t("th")])],-1),L=["onClick","checked"],V={class:"d-none d-md-table-cell"},S={class:"py-1 rounded-pill bg-light text-center text-nowrap"},D={key:0,class:"text-danger text-nowrap"},N={key:1},R={class:"d-none d-lg-table-cell"},G={class:"d-none d-md-table-cell"},Q={class:"btn-group align-items-center"},H=["onClick"],O=t("i",{class:"bi bi-pencil text-default"},null,-1),j=[O],q=["onClick"],z=t("i",{class:"bi bi-trash text-danger"},null,-1),F=[z];function M(e,o,s,i,n,l){const f=_("router-link"),x=_("PaginationComponent");return r(),c("div",y,[t("div",I,[W,p(f,{to:"/admin/articleinfo/new",class:"btn btn-dark"},{default:g(()=>[B("建立文章")]),_:1})]),t("div",null,[n.currentArticles.length?(r(),c("table",P,[E,t("tbody",null,[(r(!0),c(w,null,C(n.currentArticles,a=>(r(),c("tr",{key:a.id},[t("td",null,[t("input",{class:"form-check-input",type:"checkbox",id:"checkboxNoLabel",value:"","aria-label":"setTopArticle",onClick:m=>l.setTopArticle(a.id),checked:a.isTop,ref_for:!0,ref:"topArticleCheckBox"+a.id},null,8,L)]),t("td",null,u(a.title),1),t("td",V,[t("p",S,u(a.category),1)]),t("td",null,[a.isPublic?(r(),c("span",D,"發佈中")):(r(),c("span",N,"未發佈"))]),t("td",R,u(a.author),1),t("td",G,u(new Date(a.create_at*1e3).toLocaleDateString()),1),t("td",null,[t("div",Q,[t("button",{type:"button",class:"btn border-0",onClick:m=>l.showArticlePage(a.id)},j,8,H),t("button",{type:"button",class:"btn border-0",onClick:m=>l.deleteArticle(a.id)},F,8,q),p(f,{class:b(["d-none d-sm-table-cell btn border-0",{"pe-none":!a.isPublic}]),target:"_blank",to:`/articleinfo/${a.id}`},{default:g(()=>[t("i",{class:b(["bi bi-house",a.isPublic?"text-default":"text-light"])},null,2)]),_:2},1032,["to","class"])])])]))),128))])])):(r(),c("p",v,"目前沒有文章")),p(x,{pagination:n.pagination,onGetList:l.getCurrentArticles},null,8,["pagination","onGetList"])])])}const ut=k($,[["render",M]]);export{ut as default};
